<!doctype html>
<html>
<head>
    <title>Awair Status</title>
    <script type="text/javascript" src="superagent.js"></script>
    <script type="text/javascript">
function loadData(ip) {
    superagent.get("http://" + ip + "/air-data/latest", function(d) {
        var json = JSON.parse(d.text);
        console.log(json);
        displayData(json);
    })
}

function displayData(json) {
    document.querySelector("#awair-score").innerText = json["score"];
    function toF(c) {
        return parseInt(32 + (c * 9) / 5);
    }
    document.querySelector("#awair-temp").innerText = toF(json["temp"]);
    document.querySelector("#awair-humid").innerText = json["humid"];
    document.querySelector("#awair-co2").innerText = json["co2"];
    function co2color(n) {
        if (n <= 600) {
            return 'green';
        } else if (n <= 1000) {
            return 'yellow';
        } else if (n <= 1500) {
            return 'orange';
        } else {
            return 'red';
        }
    }
    document.querySelector("#awair-co2").style.color = co2color(json["co2"]);
}

window.onload = function() {
    var ip = location.search.split("ip=")[1];
    if (ip) ip = ip.split("&")[0];
    if (ip) {
        loadData(ip);
    } else {
        document.write("Please specify an Awair IP");
    }

    var dark = location.search.split("dark=")[1];
    if (dark) {
        dark = dark.split("&")[0];
        document.querySelector("body").classList.add('dark');
        if (dark.length > 1) {
            document.querySelector("body").style.background = dark;
        }
    }
    var zoom = location.search.split("zoom=")[1];
    if (zoom) {
        zoom = zoom.split("&")[0];
        document.querySelector("body").style.zoom = zoom;
    }

    setInterval(function() { location.reload() }, 5 * 60 * 1000);
}
    </script>
    <meta http-equiv="refresh" content="300" />
    <style>
body {
    font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
}
body.dark {
    background: #343a40;
    color: white;
}
tr th, tr td {
    padding: 5px 10px;
    text-align: left;
}
th:after {
    content: ":";
}
#awair-score:after {
    content: " / 100";
}
#awair-temp:after {
    content: "\00B0 F";
}
#awair-humid:after {
    content: "%";
}
    </style>

</head>
<body>
    <table>
        <tr>
            <th>Awair Score</th>
            <td id="awair-score"></td>
        </tr>

        <tr>
            <th>Temperature</th>
            <td id="awair-temp"></td>
        </tr>

        <tr>
            <th>Humidity</th>
            <td id="awair-humid"></td>
        </tr>

        <tr>
            <th>CO2</th>
            <td id="awair-co2"></td>
        </tr>
    </table>
</body>
</html>